apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: cluster-autoscaler
  namespace: m-and-m
spec:
  interval: 1m
  url: https://kubernetes.github.io/autoscaler

---

apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: cluster-autoscaler
  namespace: m-and-m
  # this is where "flags" normally used with helm install should be placed metadata.annotations
  # example of how to structure the flag to annotation conversion at link below:
  # https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md
  # https://alicegg.tech/2020/11/09/helm.html
#    annotations:
#      "cluster-autoscaler.kubernetes.io/scale-down-unneeded-time": "600s"
spec:
  interval: 1m
  releaseName: cluster-autoscaler
  chart:
    spec:
      #chart.spec.chart specifies the chart from the source to be deployed
      #try changing spec.chart to cluster-autoscaler/cluster-autoscaler
      chart: cluster-autoscaler
      sourceRef:
        kind: HelmRepository
        name: cluster-autoscaler
        namespace: openverso
#    targetNamespace: m-and-m

---

apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: cluster-autoscaler
  namespace: m-and-m
spec:
  interval: 1m
  path: "."
  prune: true
  sourceRef:
    kind: HelmRepository
    name: cluster-autoscaler
  healthChecks:
    - apiVersion: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      name: cluster-autoscaler
      namespace: m-and-m
  timeout: 1m